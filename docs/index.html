<!DOCTYPE html>
<html class="default" lang="en" data-base="./">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="IE=edge" />
    <title>@theredspace/spp-client API Module</title>
    <meta
      name="description"
      content="Documentation for @theredspace/spp-client, a TypeScript client for the OpenAir SuiteProjects Pro XML API"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="assets/style.css" />
    <link rel="stylesheet" href="assets/highlight.css" />
    <script defer src="assets/main.js"></script>
    <script async src="assets/icons.js" id="tsd-icons-script"></script>
    <script async src="assets/search.js" id="tsd-search-script"></script>
    <script async src="assets/navigation.js" id="tsd-nav-script"></script>
    <script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script>
  </head>
  <body>
    <script>
      document.documentElement.dataset.theme =
        localStorage.getItem("tsd-theme") || "os";
      document.body.style.display = "none";
      setTimeout(
        () =>
          window.app
            ? app.showPage()
            : document.body.style.removeProperty("display"),
        500
      );
    </script>

    <header class="tsd-page-toolbar">
      <div class="tsd-toolbar-contents container">
        <a href="index.html" class="title">@theredspace/spp-client</a>
        <div id="tsd-toolbar-links"></div>
        <button id="tsd-search-trigger" class="tsd-widget" aria-label="Search">
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            aria-hidden="true"
          >
            <use href="assets/icons.svg#icon-search"></use>
          </svg>
        </button>
        <dialog id="tsd-search" aria-label="Search">
          <input
            role="combobox"
            id="tsd-search-input"
            aria-controls="tsd-search-results"
            aria-autocomplete="list"
            aria-expanded="true"
            autocapitalize="off"
            autocomplete="off"
            placeholder="Search the docs"
            maxlength="100"
          />
          <ul role="listbox" id="tsd-search-results"></ul>
          <div
            id="tsd-search-status"
            aria-live="polite"
            aria-atomic="true"
          >
            <div>Preparing search index...</div>
          </div>
        </dialog>
        <a
          href="#"
          class="tsd-widget menu"
          id="tsd-toolbar-menu-trigger"
          data-toggle="menu"
          aria-label="Menu"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            aria-hidden="true"
          >
            <use href="assets/icons.svg#icon-menu"></use>
          </svg>
        </a>
      </div>
    </header>

    <div class="container container-main">
      <div class="col-content">
        <div class="tsd-page-title">
          <h1>@theredspace/spp-client API Module</h1>
        </div>
        <div class="tsd-panel tsd-typography">
          <!-- Badge and License -->
          <p>
            <a
              href="https://opensource.org/licenses/Apache-2.0"
              target="_blank"
            >
              <img
                src="https://img.shields.io/badge/License-Apache%202.0-blue.svg"
                alt="License: Apache-2.0"
              />
            </a>
          </p>

          <p>
            A TypeScript client library for interacting with the OpenAir
            SuiteProjects Pro (SPP) XML API. This package provides a core
            <code>SPPClient</code> for making direct API calls and pre-built,
            type-safe BusinessObject Services for all SuiteProjects Pro
            objects.
          </p>

          <h2 id="features" class="tsd-anchor-link">
            Features
            <a
              href="#features"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <ul>
            <li>Modern ECMAScript Module (ESM) and TypeScript-first design.</li>
            <li>Core <code>SPPClient</code> for flexible XML API communication.</li>
            <li>Type-safe services for all SPP objects (e.g., Invoices, Projects, Users).</li>
            <li>Handles OAuth 2.0 authentication, including automatic token refresh.</li>
            <li>Callbacks for <code>onRefresh</code> (to persist new tokens) and <code>onError</code> (for critical client errors).</li>
            <li>Automatic parsing of XML responses into JavaScript objects.</li>
            <li>Comprehensive error handling with custom, typed errors (<code>SPPAuthError</code>, <code>SPPBusinessError</code>, etc.).</li>
            <li>Extensive list of <code>SPPStatus</code> codes and <code>SPPStatusInfo</code> for easy error identification and handling.</li>
          </ul>

          <h2 id="installation" class="tsd-anchor-link">
            Installation
            <a
              href="#installation"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <p>
            To use <code>@theredspace/spp-api-client</code>, configure your
            package manager to fetch packages from GitHub Packages under the
            <code>@theredspace</code> scope.
          </p>
          <p><strong>1. Configure <code>.npmrc</code></strong></p>
          <p><strong>Option A: Edit <code>.npmrc</code> file directly (Recommended)</strong></p>
          <pre><code>@theredspace:registry=https://npm.pkg.github.com
//npm.pkg.github.com/:_authToken=YOUR_GITHUB_TOKEN</code></pre>
          <p>
            Replace <code>YOUR_GITHUB_TOKEN</code> with a
            <a
              href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens"
              target="_blank"
              >GitHub Personal Access Token (PAT)</a
            > with <code>read:packages</code> scope.
          </p>
          <p><strong>Option B: <code>npm login</code> (for local development)</strong></p>
          <pre><code>npm login --registry=https://npm.pkg.github.com --scope=@theredspace</code></pre>

          <p><strong>2. Install the Package</strong></p>
          <pre><code>npm install @theredspace/spp-client@latest
# or
yarn add @theredspace/spp-client@latest</code></pre>

          <h2 id="authentication" class="tsd-anchor-link">
            Authentication
            <a
              href="#authentication"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <p>
            Before making API calls, you need OAuth 2.0 tokens. Follow these
            steps:
          </p>
          <ol>
            <li>
              <strong>Get the authorization URL and redirect the user</strong>
              <pre><code class="ts">import { SPPClient } from "@theredspace/spp-api-client";
const authClient = new SPPClient({
  sppUrl: process.env.SPP_URL,
  clientId: process.env.SPP_CLIENT_ID,
  clientSecret: process.env.SPP_CLIENT_SECRET,
  callbackUrl: process.env.SPP_CALLBACK_URL,
});
const authorizationUrl = authClient.getAuthUrl();
console.log("Visit this URL to authorize:", authorizationUrl);</code></pre>
            </li>
            <li>
              <strong>Exchange the authorization code for tokens</strong>
              <p>
                After the user grants access, your app receives a
                <code>code</code> query parameter at your callback URL. Exchange
                it for tokens:
              </p>
              <pre><code class="bash">curl -X POST "${SPP_URL}/login/oauth2/v1/token" \
  -u "${CLIENT_ID}:${CLIENT_SECRET}" \
  -d "grant_type=authorization_code&code=AUTH_CODE&redirect_uri=${CALLBACK_URL}"</code></pre>
              <p>Response:</p>
              <pre><code class="json">{
  "access_token": "<ACCESS_TOKEN>",
  "refresh_token": "<REFRESH_TOKEN>"
}</code></pre>
            </li>
            <li>
              <strong>Initialize client with tokens</strong>
              <pre><code class="ts">const client = new SPPClient({
  sppUrl: process.env.SPP_URL,
  clientId: process.env.SPP_CLIENT_ID,
  clientSecret: process.env.SPP_CLIENT_SECRET,
  callbackUrl: process.env.SPP_CALLBACK_URL,
  accessToken: "<ACCESS_TOKEN>",
  refreshToken: "<REFRESH_TOKEN>",
  onRefresh: async ({ access_token, refresh_token }) => {
    // persist new tokens
  },
});</code></pre>
            </li>
          </ol>

          <h2 id="quick-start" class="tsd-anchor-link">
            Quick Start
            <a
              href="#quick-start"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <p>
            1. <strong>Configure environment</strong> (either via constructor or
            environment variables):
          </p>
          <pre><code class="bash">export SPP_URL="https://your.openair.com/suiteprojects/etc/etc/"
export SPP_CLIENT_ID="<your_client_id>"
export SPP_CLIENT_SECRET="<your_client_secret>"
export SPP_CALLBACK_URL="<your_callback_url>"</code></pre>
          <p>
            2. <strong>Initialize client</strong>:
          </p>
          <pre><code class="ts">import { SPPClient } from "@theredspace/spp-api-client";
const client = new SPPClient({
  sppUrl: process.env.SPP_URL,
  clientId: process.env.SPP_CLIENT_ID,
  clientSecret: process.env.SPP_CLIENT_SECRET,
  callbackUrl: process.env.SPP_CALLBACK_URL,
  onRefresh: async ({ access_token, refresh_token }) => {
    // persist tokens securely
  },
});</code></pre>

          <h2 id="core-methods" class="tsd-anchor-link">
            Using Core Methods (List, Add, Update, Delete)
            <a
              href="#core-methods"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <h3>List Method Examples</h3>
          <pre><code class="ts">// Fetch all records for an object
const users = await client.list("User");

// Fetch one record with a filter
const customers = await client.list("Customer", { country: "US" });

// Fetch many records with an array of ids using batchList
const items = await client.batchList(
  "Schedulerequest_item",
  itemIds.map((id) => ({ id: String(id) }))
);</code></pre>

          <h3>Add Method Examples</h3>
          <pre><code class="ts">// Add a single object
const invoice = await client.add("Invoice", {
  customerid: 1,
  total: 100,
});

// Add object with Date property
const request = await client.add("Schedulerequest", {
  startdate: "2024-06-01",
  enddate: "2024-06-05",
  userid: 42,
  externalid: "external-123",
});

// Add multiple new objects at once
const newProjects = [
  {
    name: "Website Redesign",
    customerid: 1,
    externalid: "proj-001",
  },
  {
    name: "Mobile App Launch",
    customerid: 2,
    externalid: "proj-002",
  },
];
const createdProjects = await client.add("Project", newProjects);</code></pre>

          <h3>Update Method Examples</h3>
          <pre><code class="ts">// Update one object by id, passing in change object.
const updatedUser = await client.update("User", 16, {
  nickname: "janedoe@example.com",
});

// Update many objects by passing in an array of change objects.
const updates = [
  { id: 101, changes: { status: "Active" } },
  { id: 102, changes: { status: "Completed" } },
  { id: 103, changes: { status: "On Hold" } },
];
const updatedProjects = await client.update("Project", updates);</code></pre>

          <h3>Delete Method Examples</h3>
          <pre><code class="ts">// Delete one object by id. Returns an array of Results
const deletedInvoice = await client.delete("Invoice", 123);

// Delete many objects by an array of ids
const deletedInvoices = await client.delete("Invoice", [123, 456]);</code></pre>

          <h2 id="rate-limiting" class="tsd-anchor-link">
            API Rate Limiting &amp; Request Limits
            <a
              href="#rate-limiting"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <p>
            <strong>Important:</strong><br />
            The SuiteProjects API enforces a limit of 1,000 requests at a
            time. If you exceed this limit, your requests may be throttled or
            rejected.
          </p>
          <p><strong>Best Practices:</strong></p>
          <ul>
            <li>Batch your requests by passing arrays to <code>add</code>, <code>update</code>, or <code>delete</code>.</li>
            <li>Use pagination for large data sets.</li>
            <li>Implement retry logic with exponential backoff for 429 (Too Many Requests) errors.</li>
            <li>Monitor your request volume and avoid sending bursts of requests.</li>
          </ul>
          <p>
            If you need to process more than 1,000 records, consider spreading
            your requests over time or paginating your requests.
          </p>

          <h2 id="error-handling" class="tsd-anchor-link">
            Error Handling &amp; Error Codes
            <a
              href="#error-handling"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <p>
            All methods throw <strong>typed errors</strong> that extend
            JavaScript’s <code>Error</code> class. You can catch and handle
            these using <code>try/catch</code> blocks. The main error types
            are:
          </p>
          <ul>
            <li><code>SPPAuthError</code> – Authentication or token issues</li>
            <li><code>SPPRequestError</code> – Network or HTTP-level failures</li>
            <li><code>SPPResponseError</code> – Malformed or unexpected API responses</li>
            <li><code>SPPBusinessError</code> – API-level business logic errors (non-zero SPP status codes)</li>
          </ul>
          <p>
            Each error includes a <code>.detail</code> property with a
            <code>code</code> and <code>message</code> for debugging.
          </p>
          <h3>Example</h3>
          <pre><code class="ts">import {
  SPPAuthError,
  SPPBusinessError,
  SPPStatus,
  SPPStatusInfo,
} from "@theredspace/spp-api-client";

try {
  await client.add("User", { name: "Test", externalid: "test-001" });
} catch (err) {
  if (err instanceof SPPAuthError) {
    console.error("Authentication error:", err.detail.message);
  } else if (err instanceof SPPBusinessError) {
    const code = err.detail.code;
    const info = SPPStatusInfo[code as SPPStatus];
    console.error(
      \`Business error: \${info?.name || code} - \${info?.description || err.detail.message}\`
    );
  } else {
    console.error("Unexpected error:", err);
  }
}</code></pre>

          <h2 id="status-codes" class="tsd-anchor-link">
            SPP Status Codes
            <a
              href="#status-codes"
              aria-label="Permalink"
              class="tsd-anchor-icon"
            >
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <use href="assets/icons.svg#icon-anchor"></use>
              </svg>
            </a>
          </h2>
          <p>
            All business/API errors include a numeric or string <code>code</code>
            (see the <code>SPPStatus</code> enum). You can look up
            human-friendly names and descriptions using
            <code>SPPStatusInfo</code>.
          </p>
          <h3>Example</h3>
          <pre><code class="ts">const code = 202; // e.g., from err.detail.code
const info = SPPStatusInfo[code];
console.log(info.name);        // "UserDuplicateNickname"
console.log(info.description); // "There is already a user with the same User ID (nickname)"
</code></pre>
          <p>
            For a full list of status codes and their meanings, see
            <a href="utils/errorCodes.ts" target="_blank">src/utils/errorCodes.ts</a>.
          </p>

          <hr />
          <p>© 2025 The REDspace · Apache-2.0</p>
        </div>
      </div>

      <div class="col-sidebar">
        <div class="page-menu">
          <div class="tsd-navigation settings">
            <details class="tsd-accordion">
              <summary class="tsd-accordion-summary">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  aria-hidden="true"
                >
                  <use href="assets/icons.svg#icon-chevronDown"></use>
                </svg>
                <h3>Settings</h3>
              </summary>
              <div class="tsd-accordion-details">
                <div class="tsd-filter-visibility">
                  <span class="settings-label">Member Visibility</span>
                  <ul id="tsd-filter-options">
                    <li class="tsd-filter-item">
                      <label class="tsd-filter-input">
                        <input
                          type="checkbox"
                          id="tsd-filter-protected"
                          name="protected"
                        /><svg
                          width="32"
                          height="32"
                          viewBox="0 0 32 32"
                          aria-hidden="true"
                        >
                          <rect
                            class="tsd-checkbox-background"
                            width="30"
                            height="30"
                            x="1"
                            y="1"
                            rx="6"
                            fill="none"
                          ></rect>
                          <path
                            class="tsd-checkbox-checkmark"
                            d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
                            stroke="none"
                            stroke-width="3.5"
                            stroke-linejoin="round"
                            fill="none"
                          ></path>
                        </svg>
                        <span>Protected</span>
                      </label>
                    </li>
                    <li class="tsd-filter-item">
                      <label class="tsd-filter-input">
                        <input
                          type="checkbox"
                          id="tsd-filter-inherited"
                          name="inherited"
                          checked
                        /><svg
                          width="32"
                          height="32"
                          viewBox="0 0 32 32"
                          aria-hidden="true"
                        >
                          <rect
                            class="tsd-checkbox-background"
                            width="30"
                            height="30"
                            x="1"
                            y="1"
                            rx="6"
                            fill="none"
                          ></rect>
                          <path
                            class="tsd-checkbox-checkmark"
                            d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
                            stroke="none"
                            stroke-width="3.5"
                            stroke-linejoin="round"
                            fill="none"
                          ></path>
                        </svg>
                        <span>Inherited</span>
                      </label>
                    </li>
                    <li class="tsd-filter-item">
                      <label class="tsd-filter-input">
                        <input
                          type="checkbox"
                          id="tsd-filter-external"
                          name="external"
                        /><svg
                          width="32"
                          height="32"
                          viewBox="0 0 32 32"
                          aria-hidden="true"
                        >
                          <rect
                            class="tsd-checkbox-background"
                            width="30"
                            height="30"
                            x="1"
                            y="1"
                            rx="6"
                            fill="none"
                          ></rect>
                          <path
                            class="tsd-checkbox-checkmark"
                            d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
                            stroke="none"
                            stroke-width="3.5"
                            stroke-linejoin="round"
                            fill="none"
                          ></path>
                        </svg>
                        <span>External</span>
                      </label>
                    </li>
                  </ul>
                </div>
                <div class="tsd-theme-toggle">
                  <label class="settings-label" for="tsd-theme">Theme</label>
                  <select id="tsd-theme">
                    <option value="os">OS</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                  </select>
                </div>
              </div>
            </details>
          </div>
          <details open class="tsd-accordion tsd-page-navigation">
            <summary class="tsd-accordion-summary">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                aria-hidden="true"
              >
                <use href="assets/icons.svg#icon-chevronDown"></use>
              </svg>
              <h3>On This Page</h3>
            </summary>
            <div class="tsd-accordion-details">
              <a href="#features"><span>Features</span></a>
              <ul>
                <li><a href="#installation"><span>Installation</span></a></li>
                <li><a href="#authentication"><span>Authentication</span></a></li>
                <li><a href="#quick-start"><span>Quick Start</span></a></li>
                <li><a href="#core-methods"><span>Using Core Methods</span></a></li>
                <li><a href="#rate-limiting"><span>API Rate Limiting</span></a></li>
                <li><a href="#error-handling"><span>Error Handling</span></a></li>
                <li><a href="#status-codes"><span>SPP Status Codes</span></a></li>
              </ul>
            </div>
          </details>
        </div>
        <div class="site-menu">
          <nav class="tsd-navigation">
            <a href="modules.html">@theredspace/spp-client</a>
            <ul class="tsd-small-nested-navigation" id="tsd-nav-container">
              <li>Loading...</li>
            </ul>
          </nav>
        </div>
      </div>
    </div>

    <footer>
      <p class="tsd-generator">
        Generated using
        <a href="https://typedoc.org/" target="_blank">TypeDoc</a>
      </p>
    </footer>
    <div class="overlay"></div>
  </body>
</html>